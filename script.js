const exchangeRatesData = {
    "result": "success",
    "documentation": "https://www.exchangerate-api.com/docs",
    "terms_of_use": "https://www.exchangerate-api.com/terms",
    "time_last_update_unix": 1709078401,
    "time_last_update_utc": "Wed, 28 Feb 2024 00:00:01 +0000",
    "time_next_update_unix": 1709164801,
    "time_next_update_utc": "Thu, 29 Feb 2024 00:00:01 +0000",
    "base_code": "USD",
    "conversion_rates": {
        "USD": 1,
        "AED": 3.6725,
        "AFN": 73.3267,
        "ALL": 95.7123,
        "AMD": 404.9383,
        "ANG": 1.7900,
        "AOA": 842.7707,
        "ARS": 841.1500,
        "AUD": 1.5278,
        "AWG": 1.7900,
        "AZN": 1.7002,
        "BAM": 1.8031,
        "BBD": 2.0000,
        "BDT": 109.7485,
        "BGN": 1.8030,
        "BHD": 0.3760,
        "BIF": 2844.3748,
        "BMD": 1.0000,
        "BND": 1.3437,
        "BOB": 6.9161,
        "BRL": 4.9752,
        "BSD": 1.0000,
        "BTN": 82.9077,
        "BWP": 13.7853,
        "BYN": 3.2575,
        "BZD": 2.0000,
        "CAD": 1.3518,
        "CDF": 2734.2554,
        "CHF": 0.8792,
        "CLP": 987.9145,
        "CNY": 7.2053,
        "COP": 3947.3873,
        "CRC": 514.6275,
        "CUP": 24.0000,
        "CVE": 101.6568,
        "CZK": 23.3468,
        "DJF": 177.7210,
        "DKK": 6.8763,
        "DOP": 58.7461,
        "DZD": 134.4083,
        "EGP": 30.8961,
        "ERN": 15.0000,
        "ETB": 56.6298,
        "EUR": 0.9220,
        "FJD": 2.2638,
        "FKP": 0.7884,
        "FOK": 6.8777,
        "GBP": 0.7884,
        "GEL": 2.6543,
        "GGP": 0.7884,
        "GHS": 12.6876,
        "GIP": 0.7884,
        "GMD": 66.2933,
        "GNF": 8571.9743,
        "GTQ": 7.8057,
        "GYD": 209.1526,
        "HKD": 7.8246,
        "HNL": 24.6834,
        "HRK": 6.9463,
        "HTG": 132.7786,
        "HUF": 359.8592,
        "IDR": 15668.4300,
        "ILS": 3.6140,
        "IMP": 0.7884,
        "INR": 82.9112,
        "IQD": 1308.3208,
        "IRR": 42063.7763,
        "ISK": 137.5679,
        "JEP": 0.7884,
        "JMD": 156.1401,
        "JOD": 0.7090,
        "JPY": 150.4178,
        "KES": 145.7397,
        "KGS": 89.4550,
        "KHR": 4098.9228,
        "KID": 1.5278,
        "KMF": 453.5606,
        "KRW": 1331.0854,
        "KWD": 0.3076,
        "KYD": 0.8333,
        "KZT": 449.9878,
        "LAK": 20678.9097,
        "LBP": 89500.0000,
        "LKR": 310.2249,
        "LRD": 192.1180,
        "LSL": 19.1060,
        "LYD": 4.8329,
        "MAD": 10.0612,
        "MDL": 17.8287,
        "MGA": 4532.1767,
        "MKD": 56.8544,
        "MMK": 2101.7533,
        "MNT": 3416.5638,
        "MOP": 8.0594,
        "MRU": 39.9343,
        "MUR": 45.6858,
        "MVR": 15.4389,
        "MWK": 1691.2896,
        "MXN": 17.0664,
        "MYR": 4.7636,
        "MZN": 63.8857,
        "NAD": 19.1060,
        "NGN": 1543.3820,
        "NIO": 36.7783,
        "NOK": 10.5310,
        "NPR": 132.6524,
        "NZD": 1.6208,
        "OMR": 0.3845,
        "PAB": 1.0000,
        "PEN": 3.7921,
        "PGK": 3.7862,
        "PHP": 56.0905,
        "PKR": 279.3143,
        "PLN": 3.9711,
        "PYG": 7299.9460,
        "QAR": 3.6400,
        "RON": 4.5774,
        "RSD": 107.9763,
        "RUB": 92.0499,
        "RWF": 1292.3521,
        "SAR": 3.7500,
        "SBD": 8.2957,
        "SCR": 13.7272,
        "SDG": 449.3075,
        "SEK": 10.3029,
        "SGD": 1.3438,
        "SHP": 0.7884,
        "SLE": 22.7954,
        "SLL": 22795.3822,
        "SOS": 571.4665,
        "SRD": 35.3847,
        "SSP": 1381.0879,
        "STN": 22.5873,
        "SYP": 12898.7580,
        "SZL": 19.1060,
        "THB": 35.8591,
        "TJS": 10.9544,
        "TMT": 3.5000,
        "TND": 3.1184,
        "TOP": 2.3587,
        "TRY": 31.1606,
        "TTD": 6.7638,
        "TVD": 1.5278,
        "TWD": 31.5930,
        "TZS": 2540.3286,
        "UAH": 38.3957,
        "UGX": 3936.3340,
        "UYU": 38.8772,
        "UZS": 12558.3578,
        "VES": 36.0706,
        "VND": 24627.7190,
        "VUV": 120.3428,
        "WST": 2.7331,
        "XAF": 604.7475,
        "XCD": 2.7000,
        "XDR": 0.7528,
        "XOF": 604.7475,
        "XPF": 110.0159,
        "YER": 250.1745,
        "ZAR": 19.1027,
        "ZMW": 23.1639,
        "ZWL": 14293.1768
        // Other currency conversion rates...
    }
};

const dropdowns = document.querySelectorAll(".dropdown select");
const btn = document.querySelector("form button");
const fromCurr = document.querySelector(".from select");
const toCurr = document.querySelector(".to select");
const msg = document.querySelector(".msg");

for (let select of dropdowns) {
    for (let codeCurr in exchangeRatesData.conversion_rates) {
        let newOption = document.createElement("option");
        newOption.innerText = codeCurr;
        newOption.value = codeCurr;
        if (select.name === "from" && codeCurr === "USD") {
            newOption.selected = "selected";
        } else if (select.name === "to" && codeCurr === "INR") {
            newOption.selected = "selected";
        }
        select.append(newOption);
    }
    select.addEventListener("change", (evt) => {
        updateFlag(evt.target);
    });
}

const updateExchangeRate = () => {
    let amount = document.querySelector(".amount input");
    let amtVal = amount.value;
    if (amtVal === "" || amtVal < 1) {
        amtVal = 1;
        amount.value = "1";
    }

    let rate = exchangeRatesData.conversion_rates[toCurr.value];

    let finalAmount = amtVal * rate;
    msg.innerText = `${amtVal} ${fromCurr.value} = ${finalAmount.toFixed(2)} ${toCurr.value}`;
};

const updateFlag = (element) => {
    let codeCurr = element.value;
    // Assume there's a mapping from currency codes to country codes
    // Replace this with your own logic or data structure
    const countryCodes = {
        AED: "AE",
        AFN: "AF",
        XCD: "AG",
        ALL: "AL",
        AMD: "AM",
        ANG: "AN",
        AOA: "AO",
        AQD: "AQ",
        ARS: "AR",
        AUD: "AU",
        AZN: "AZ",
        BAM: "BA",
        BBD: "BB",
        BDT: "BD",
        XOF: "BE",
        BGN: "BG",
        BHD: "BH",
        BIF: "BI",
        BMD: "BM",
        BND: "BN",
        BOB: "BO",
        BRL: "BR",
        BSD: "BS",
        NOK: "BV",
        BWP: "BW",
        BYR: "BY",
        BZD: "BZ",
        CAD: "CA",
        CDF: "CD",
        XAF: "CF",
        CHF: "CH",
        CLP: "CL",
        CNY: "CN",
        COP: "CO",
        CRC: "CR",
        CUP: "CU",
        CVE: "CV",
        CYP: "CY",
        CZK: "CZ",
        DJF: "DJ",
        DKK: "DK",
        DOP: "DO",
        DZD: "DZ",
        ECS: "EC",
        EEK: "EE",
        EGP: "EG",
        ETB: "ET",
        EUR: "FR",
        FJD: "FJ",
        FKP: "FK",
        GBP: "GB",
        GEL: "GE",
        GGP: "GG",
        GHS: "GH",
        GIP: "GI",
        GMD: "GM",
        GNF: "GN",
        GTQ: "GT",
        GYD: "GY",
        HKD: "HK",
        HNL: "HN",
        HRK: "HR",
        HTG: "HT",
        HUF: "HU",
        IDR: "ID",
        ILS: "IL",
        INR: "IN",
        IQD: "IQ",
        IRR: "IR",
        ISK: "IS",
        JMD: "JM",
        JOD: "JO",
        JPY: "JP",
        KES: "KE",
        KGS: "KG",
        KHR: "KH",
        KMF: "KM",
        KPW: "KP",
        KRW: "KR",
        KWD: "KW",
        KYD: "KY",
        KZT: "KZ",
        LAK: "LA",
        LBP: "LB",
        LKR: "LK",
        LRD: "LR",
        LSL: "LS",
        LTL: "LT",
        LVL: "LV",
        LYD: "LY",
        MAD: "MA",
        MDL: "MD",
        MGA: "MG",
        MKD: "MK",
        MMK: "MM",
        MNT: "MN",
        MOP: "MO",
        MRO: "MR",
        MTL: "MT",
        MUR: "MU",
        MVR: "MV",
        MWK: "MW",
        MXN: "MX",
        MYR: "MY",
        MZN: "MZ",
        NAD: "NA",
        XPF: "NC",
        NGN: "NG",
        NIO: "NI",
        NPR: "NP",
        NZD: "NZ",
        OMR: "OM",
        PAB: "PA",
        PEN: "PE",
        PGK: "PG",
        PHP: "PH",
        PKR: "PK",
        PLN: "PL",
        PYG: "PY",
        QAR: "QA",
        RON: "RO",
        RSD: "RS",
        RUB: "RU",
        RWF: "RW",
        SAR: "SA",
        SBD: "SB",
        SCR: "SC",
        SDG: "SD",
        SEK: "SE",
        SGD: "SG",
        SKK: "SK",
        SLL: "SL",
        SOS: "SO",
        SRD: "SR",
        STD: "ST",
        SVC: "SV",
        SYP: "SY",
        SZL: "SZ",
        THB: "TH",
        TJS: "TJ",
        TMT: "TM",
        TND: "TN",
        TOP: "TO",
        TRY: "TR",
        TTD: "TT",
        TWD: "TW",
        TZS: "TZ",
        UAH: "UA",
        UGX: "UG",
        USD: "US",
        UYU: "UY",
        UZS: "UZ",
        VEF: "VE",
        VND: "VN",
        VUV: "VU",
        YER: "YE",
        ZAR: "ZA",
        ZMK: "ZM",
        ZWD: "ZW",
        // Add more currency to country code mappings as needed
    };
    let countryCode = countryCodes[codeCurr];
    let newSrc = `https://flagsapi.com/${countryCode}/flat/64.png`;
    let img = element.parentElement.querySelector("img");
    img.src = newSrc;
};


btn.addEventListener("click", (evt) => {
    evt.preventDefault();
    updateExchangeRate();
});

window.addEventListener("load", () => {
    updateExchangeRate();
});
